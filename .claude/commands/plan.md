---
description: PM 规划 — 需求代码化为 PRD、任务树、验收标准 (Claude Opus)
argument-hint: [需求描述]
---

# PM 规划阶段 (2025 Optimized)

**主控**: Claude Opus 4.5 (规划总控)

## 任务

$ARGUMENTS

## 执行流程

遵循项目规则和治理：
- 读取并遵循：.council/AGENTS.md 和 .council/CLAUDE.md
- 参考输入（如存在）：CODEMAP.md, .council/BRIEF.md, .council/SPEC.md

### 1. 需求分析

**提取关键信息**：
- 用户痛点：当前存在什么问题？
- 目标状态：期望达到什么效果？
- 非目标：明确不做什么（避免范围蔓延）

### 2. 生成 PRD (Product Requirements Document)

输出结构：

```markdown
## 问题陈述
- 当前状态：[现状 + 痛点]
- 目标状态：[期望效果]
- 非目标：[明确排除项]

## 用户故事
作为 [角色]，
我希望 [功能]，
以便 [价值]。

## 验收标准
- [ ] AC1: [可测试的具体标准]
- [ ] AC2: [可测试的具体标准]
- [ ] AC3: ...
```

### 3. 任务树分解

**要求**：
- 拆分为 3-7 个可独立执行的子任务
- 每个任务标注影响的文件
- 按依赖关系排序
- 估算复杂度（简单/中等/复杂）

**格式**：
```
任务树
├── 1.1 [文件A] 任务描述 (复杂度: 简单)
├── 1.2 [文件B, 文件C] 任务描述 (复杂度: 中等)
└── 1.3 [文件D] 任务描述 (复杂度: 简单)
```

### 4. 模型分发建议

根据任务特点推荐模型：

| 阶段 | 模型 | 原因 |
|------|------|------|
| 审计 | Gemini Pro | 影响 ≥3 模块 / 需要 2M 上下文 |
| TDD | Gemini Flash | 高频测试编写 |
| 实现 | Gemini Flash | 快速迭代 |
| 审查 | Codex | 代码质量把关 |

### 5. 输出到 BRIEF.md

**操作**：
- 将 PRD、任务树、验收标准写入 `.council/BRIEF.md`
- 如果需要详细设计，额外生成 `.council/SPEC.md`
- 保持 BRIEF.md 简洁（单一事实来源）

## 输出要求

1. **PRD 文档**（问题/用户故事/验收标准）
2. **任务树**（3-7 个子任务，标注文件）
3. **模型分发建议**（哪个阶段用哪个模型）
4. **写入 `.council/BRIEF.md`**

## 下游命令

规划完成后，建议执行：
```bash
# 如果影响 ≥3 模块
/audit "<任务范围>"

# 直接开始 TDD
/tdd "<第一个子任务>"
```

## 示例

**输入**：
```
/plan "优化 Telegram 消息的翻译显示，用户同时看到原文和翻译"
```

**输出**：
```markdown
## 问题陈述
- 当前状态：翻译替换原文，用户无法对比
- 目标状态：双语显示，原文+翻译同时可见
- 非目标：不做语音翻译、不做图片 OCR

## 用户故事
作为 Telegram 用户，
我希望收到消息时同时看到原文和翻译，
以便确认翻译准确性。

## 验收标准
- [ ] AC1: 收到消息显示原文+翻译
- [ ] AC2: 翻译语言可配置
- [ ] AC3: `just verify` 通过

## 任务树
├── 4.1 [config.py] 配置层增强 (简单)
├── 4.2 [message_interceptor.py] JS 双语显示 (中等)
└── 4.3 [test_message_interceptor.py] 测试覆盖 (简单)

## 模型分发
| 阶段 | 模型 | 命令 |
|------|------|------|
| TDD | Gemini Flash | /tdd "配置层增强" |
| 实现 | Gemini Flash | /impl "配置层增强" |
| 审查 | Codex | /review |
```
